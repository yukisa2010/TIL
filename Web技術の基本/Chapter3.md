# HTTPでやりとりする仕組み

## HTTPメッセージ
- HTTP from 1991
## HTTPリクエスト/HTTPレスポンス
- HTTPリクエスト
  - リクエスト行
    - GET /index.html HTTP/1.1 >>メソッド・パス名・バージョン
  - メッセージヘッダー(HTTPヘッダー)
    - Webブラウザの種類・データタイプ・圧縮方法・言語
  - 空白行
  - メッセージボディ
- HTTPレスポンス
  - ステータス行
    - HTTP/1.1 200 OK >>バージョン・ステータスコード/テキストフレーズ
  - メッセージヘッダー
  - 空白行 
  - メッセージボディー  
## HTTPメソッド
- GET
- POST
  - 情報をメッセージボディに記録して送信する
- PUT/DELETEはデータの改変が行えるのでサーバーで制限している場合も

## ステータスコード
- 1xx 情報
  - リクエスト処理中など
- 2xx 成功
- 3xx 転送
- 4xx Client Error
  - リクエストされたHTMLファイルが存在しないなど
- 5xx Server Error
  - 高負荷状態で一時的に表示できないなど
  
## TCPによるデータ通信
リクエスト・レスポンスの際の通信確保
- SYNパケット
  - クライアントからサーバーへ接続を要求するため
- ACKパケット
  - 接続の許可・切断の許可

## HTTP/1.1のやりとり
- HTTPキープアライブ
  - 画像の取得/繋げたまま
  - HTTP/1.1から登場
- HTTPパイプライン
  - responseを待つことなく次のrequestを送信できる
  - ただし、requestの順番通りにrequestを返さなければならない
## HTTP/2のやりとり
- Googleの提案したSPDYという通信の高速化を目的としたプロトコル
- ストリーム 一つのTCPコネクションに複数の仮想通信経路（ストリーム）
## HTTP/2での改良点(HTTP/1.0からの)
- テキスト形式 => バイナリ形式へ
  - 処理時間短縮・ブラウザ/サーバーへの負荷軽減
  - ヘッダーとボディがフレームという単位で分割される
- ヘッダー圧縮
  - HPACK => ヘッダー情報から差分だけを送る
- サーバープッシュ
  - ブラウザからHTMLをrequestした際、画像データをrequestされなくても事前にブラウザへ送信する

## HTTPSの仕組み
- HTTP over SSLT/TLS
  - SSL(Secure Sockets Layer)
  - TSL(Transport Layer Security)
- 安全性を確保する仕組み
  - 盗聴防止（暗号化通信）
  - 改ざん防止
    - メッセージダイジェスト
      - ハッシュ値を取り出し比較して改ざんを検知する
  - なりすまし防止
    - SSLサーバー証明書
      - 会社の身元確認、認証局による認証作業を通過
      - ランクがある（最高位だと緑で表示）
## HTTPSのやりとり
- SSL/TLS ハンドシェイク
  - TCPコネクションの確立後に以下の流れで行われる
  1. 暗号化方式の決定
    - HTTPSで利用されるSSL/TLSのバージョンの決定
    - メッセージダイジェストの方式
  2. 通信相手の証明
    - SSLサーバ証明書による確認
  3. 鍵の交換
    - 鍵は暗号化・復号化に利用される
  4. 暗号化方式の確認
    - 最終確認が行われ、通信の開始

 ## ステートフルとステートレス
 - HTTPにおいては複数のクライアントとのやりとりが必要なためステートレスにし、
    負荷を軽減している
 - ステートレス => 状態を保持しない
 
 ## Cookie
 - 状態保持・管理の仕組み
 - Webサーバー >> クライアント >> Webサーバー
 - メッセージヘッダーが利用される
  - response >> Set-Cookieヘッダ
    - 有効期限の設定可
  - request >> Cookieヘッダ
- Set-Cookieヘッダーフィールドに記述する属性
  - name=value 
  - expires=date
  - max-age=seconds
  - secure - HTTPSで通信している場合にのみCookie送信
  - httponly - JavaScriptからのCookieへの参照制限
  - domain=DOMAIN_NAME
  - path=PATH
- セッションCookie
  - 有効期限・なし（セッションCookie）　>> Webブラウザが閉じられると削除される
  - 有効期限・あり  >> ブラウザ閉じても削除されない。有効期限がくるまで残る
 
## セッション
- Cookieを用いてセッションを管理
- セッションIDを用いてブラウザを識別
  - CookieにセッションIDを含める
- セッションIDと紐づくセッションデータはWebサーバーに保存
- Cookieを使う方法と比べて情報漏洩の可能性が高い方法
  - フォームに埋め込む
  - URLに埋め込む

## URI
- Uniform Resource Identifier
- URL(...Locator)
  - URIのうちリソースが存在する場所を示すもの
- URN(...Name)
  - 場所を問わない・ex)刊行された書物など
- リクエストURI=HTTPリクエスト
  - メソッドとともに相対URIが用いられる
- パーセントエンコーディング
  - 日本語など、予約文字・非予約文字のどちらにも属さないとき
  - %xxの形式で記述(xxは16進数)
